# Authentication Parameters
$clientId = "YOUR_CLIENT_ID"
$clientSecret = "YOUR_CLIENT_SECRET"
$tokenUrl = "YOUR_TOKEN_ENDPOINT"
$apiUrl = "YOUR_API_ENDPOINT"

# Request body for the API call
$apiBody = @{
    name = "John"
    lastName = "Doe"
    phone = "+1234567890"
} | ConvertTo-Json

try {
    # First, get the access token
    $tokenBody = @{
        grant_type = "client_credentials"
        client_id = $clientId
        client_secret = $clientSecret
    }

    # Get access token
    $tokenResponse = Invoke-RestMethod -Uri $tokenUrl -Method Post -Body $tokenBody -ContentType "application/x-www-form-urlencoded"
    $accessToken = $tokenResponse.access_token

    # Create headers with the access token
    $headers = @{
        Authorization = "Bearer $accessToken"
        'Content-Type' = 'application/json'
    }

    # Make the API call with the access token
    $response = Invoke-RestMethod -Uri $apiUrl -Method Post -Headers $headers -Body $apiBody

    # Handle the response
    Write-Host "API call successful!"
    Write-Host "Response:"
    $response | ConvertTo-Json
}
catch {
    # Error handling
    Write-Host "Error occurred:"
    Write-Host "Status Code: $($_.Exception.Response.StatusCode.value__)"
    Write-Host "Status Description: $($_.Exception.Response.StatusDescription)"
    Write-Host "Error Message: $($_.Exception.Message)"
    
    # Get detailed error message if available
    if ($_.ErrorDetails.Message) {
        Write-Host "Detailed Error: $($_.ErrorDetails.Message)"
    }
}